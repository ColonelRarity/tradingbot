# –†–µ–∑—é–º–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å Trading Bot

## –í–∏–∫–æ–Ω–∞–Ω—ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

### 1. üî¥ –ö–†–ò–¢–ò–ß–ù–ê: –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é hedge –ø–æ–∑–∏—Ü—ñ–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ—Ç –ø–æ–∫–∞–∑—É–≤–∞–≤ `LONG[HEDGE]` –¥–ª—è BROCCOLI714USDT, –∞–ª–µ hedge –ø–æ–∑–∏—Ü—ñ—ó –Ω–µ –±—É–ª–æ –Ω–∞ –±—ñ—Ä–∂—ñ.

**–ü—Ä–∏—á–∏–Ω–∞:** 
- Hedge —Å—Ç–∞—Ç—É—Å –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä—è–≤—Å—è –∑ —Ä–µ–∞–ª—å–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏ –±—ñ—Ä–∂—ñ
- NET positions (parent + hedge) –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∏—Å—å –¥–ª—è –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
- Reconciliation –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä—è–≤ —Ä–µ–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω hedge –Ω–∞ –±—ñ—Ä–∂—ñ

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
1. –î–æ–¥–∞–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É NET –ø–æ–∑–∏—Ü—ñ—ó –Ω–∞ –±—ñ—Ä–∂—ñ –≤ `reconcile_with_exchange()`
   - –ü–æ—Ä—ñ–≤–Ω—é—î—Ç—å—Å—è NET size (parent + hedge) –∑ parent size
   - –Ø–∫—â–æ NET size ‚âà parent size, hedge –≤–≤–∞–∂–∞—î—Ç—å—Å—è –∑–∞–∫—Ä–∏—Ç–∏–º
   - –î–æ–¥–∞–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è

2. –ü–æ–∫—Ä–∞—â–µ–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é hedge –≤ `update_position()`
   - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ hedge —Å—Ç–∞—Ç—É—Å—É –ø—ñ—Å–ª—è `check_hedge_close()`
   - –û–Ω–æ–≤–ª–µ–Ω–Ω—è `has_hedge` —Ñ–ª–∞–≥—É –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞–Ω—É

3. –î–æ–¥–∞–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É hedge –ø–µ—Ä–µ–¥ –≤–∏–≤–µ–¥–µ–Ω–Ω—è–º –≤ `_manage_all_positions()`
   - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ hedge –¥—ñ–π—Å–Ω–æ —ñ—Å–Ω—É—î –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º `[HEDGE]` label
   - –û—á–∏—â–µ–Ω–Ω—è `has_hedge` —Ñ–ª–∞–≥—É, —è–∫—â–æ hedge –Ω–µ —ñ—Å–Ω—É—î

**–§–∞–π–ª–∏:** `core/position_tracker.py`, `main.py`

### 2. ‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É

**–î–æ–¥–∞–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è:**
- Reconciliation –æ–ø–µ—Ä–∞—Ü—ñ–π –∑ –ø–æ–≤–Ω–æ—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é
- NET positions –∑ –±—ñ—Ä–∂—ñ –¥–ª—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è
- Hedge —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∫–æ–∂–Ω—ñ–π –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ
- –í—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑ hedge (–≤—ñ–¥–∫—Ä–∏—Ç—Ç—è, –∑–∞–∫—Ä–∏—Ç—Ç—è, —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è)
- –ü–æ–∑–∏—Ü—ñ—ó: side, size, entry price, PnL
- –ü—Ä–∏—á–∏–Ω–∏ –∑–∞–∫—Ä–∏—Ç—Ç—è –ø–æ–∑–∏—Ü—ñ–π

**–§–∞–π–ª–∏:** `core/position_tracker.py`, `main.py`

### 3. ‚úÖ –î–æ–¥–∞–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è —Å—Ç–æ–ø-–ª–æ—Å—ñ–≤

**–î–æ–¥–∞–Ω–æ:**
- –î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è SL (quantity, side, price, distance)
- –î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è SL (current price, PnL, reason, breakeven/trailing)
- –î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –Ω–µ–≤–¥–∞—á (—Å—Ç–∞—Ä–∏–π SL, –Ω–æ–≤–∏–π SL, –ø–æ—Ç–æ—á–Ω–∞ —Ü—ñ–Ω–∞, quantity, side, reason)
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø—Ä–∏—á–∏–Ω –æ–Ω–æ–≤–ª–µ–Ω–Ω—è (breakeven, trailing, cooldown)

**–§–∞–π–ª–∏:** `core/position_tracker.py`

### 4. ‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω–æ reconciliation –ø–æ–∑–∏—Ü—ñ–π

**–î–æ–¥–∞–Ω–æ:**
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ hedge —á–µ—Ä–µ–∑ NET positions
- –î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è reconciliation –æ–ø–µ—Ä–∞—Ü—ñ–π
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –∑–º—ñ–Ω –ø–æ–∑–∏—Ü—ñ–π
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø—Ä–∏—á–∏–Ω –∑–∞–∫—Ä–∏—Ç—Ç—è –ø–æ–∑–∏—Ü—ñ–π

**–§–∞–π–ª–∏:** `core/position_tracker.py`

## –î–µ—Ç–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–∏ –≤ –∫–æ–¥—ñ

### `core/position_tracker.py`

1. **`reconcile_with_exchange()` (lines 672-680 ‚Üí 672-710)**
   - –î–æ–¥–∞–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É NET positions –¥–ª—è hedge
   - –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è NET size –∑ parent size
   - –î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è reconciliation –æ–ø–µ—Ä–∞—Ü—ñ–π

2. **`update_position()` (lines 485-497 ‚Üí 485-510)**
   - –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ hedge —Å—Ç–∞—Ç—É—Å—É
   - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ—Å–ª—è `check_hedge_close()`
   - –î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π –∑ hedge

3. **–õ–æ–≥—É–≤–∞–Ω–Ω—è SL (lines 232-237, 392-408)**
   - –î–æ–¥–∞–Ω–æ quantity, side –¥–æ –ª–æ–≥—ñ–≤ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è SL
   - –î–æ–¥–∞–Ω–æ current price, breakeven/trailing status –¥–æ –ª–æ–≥—ñ–≤ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è SL
   - –î–æ–¥–∞–Ω–æ quantity, side, current price –¥–æ –ª–æ–≥—ñ–≤ –Ω–µ–≤–¥–∞—á

### `main.py`

1. **`_manage_all_positions()` (lines 493-506 ‚Üí 493-525)**
   - –î–æ–¥–∞–Ω–æ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è exchange positions –¥–ª—è –≤—Å—ñ—Ö –ø–æ–∑–∏—Ü—ñ–π
   - –î–æ–¥–∞–Ω–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è NET position info –¥–ª—è hedge verification
   - –î–æ–¥–∞–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É hedge –ø–µ—Ä–µ–¥ –≤–∏–≤–µ–¥–µ–Ω–Ω—è–º `[HEDGE]` label

## –Ø–∫ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏

### –®–≤–∏–¥–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ (—Å–∏–Ω—Ç–∞–∫—Å–∏—Å):
```powershell
cd "D:\Projects\trading bot"
python -c "import core.position_tracker; import main; print('OK')"
```

### –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è:
```powershell
cd "D:\Projects\trading bot"
python main.py --log-level INFO
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª–æ–≥—ñ–≤:
```powershell
# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—ñ 100 —Ä—è–¥–∫—ñ–≤ –ª–æ–≥—É
Get-Content trading_bot.log -Tail 100

# –®—É–∫–∞—Ç–∏ reconciliation –æ–ø–µ—Ä–∞—Ü—ñ—ó
Select-String -Path trading_bot.log -Pattern "RECONCILE"

# –®—É–∫–∞—Ç–∏ hedge –æ–ø–µ—Ä–∞—Ü—ñ—ó
Select-String -Path trading_bot.log -Pattern "HEDGE|hedge"

# –®—É–∫–∞—Ç–∏ SL –æ–ø–µ—Ä–∞—Ü—ñ—ó
Select-String -Path trading_bot.log -Pattern "SL PLACED|SL UPDATED|SL UPDATE FAILED"
```

## –û—á—ñ–∫—É–≤–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏

### ‚úÖ –ü–æ–∑–∏—Ç–∏–≤–Ω—ñ –∑–º—ñ–Ω–∏:
1. Hedge –ø–æ–∑–∏—Ü—ñ—ó –±—ñ–ª—å—à–µ –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è, –∫–æ–ª–∏ —ó—Ö –Ω–µ–º–∞—î –Ω–∞ –±—ñ—Ä–∂—ñ
2. –î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –¥–æ–∑–≤–æ–ª—è—î –ø—Ä–æ—Å—Ç–µ–∂–∏—Ç–∏ –≤—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
3. Reconciliation –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î –ø–æ–∑–∏—Ü—ñ—ó –∑ –±—ñ—Ä–∂–µ—é
4. SL –æ–ø–µ—Ä–∞—Ü—ñ—ó –¥–µ—Ç–∞–ª—å–Ω–æ –ª–æ–≥—É—é—Ç—å—Å—è –∑ —É—Å—ñ—î—é –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é

### ‚ö†Ô∏è –ú–æ–∂–ª–∏–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏:
1. NET position –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –º–æ–∂–µ –±—É—Ç–∏ –Ω–µ—Ç–æ—á–Ω–æ—é –¥–ª—è –¥—É–∂–µ –º–∞–ª–∏—Ö hedge sizes (< 1% –≤—ñ–¥ parent)
2. –î–æ–¥–∞—Ç–∫–æ–≤–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –º–æ–∂–µ –∑–±—ñ–ª—å—à–∏—Ç–∏ —Ä–æ–∑–º—ñ—Ä log —Ñ–∞–π–ª—ñ–≤ (–∞–ª–µ —Ü–µ –æ—á—ñ–∫—É–≤–∞–Ω–æ)
3. –ú–æ–∂–ª–∏–≤—ñ race conditions –ø—Ä–∏ —à–≤–∏–¥–∫—ñ–π —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó (–ø–æ—Ç—Ä–µ–±—É—î —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è)

## –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏

1. ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ
2. ‚è≥ –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –±–æ—Ç–∞ –Ω–∞ –≥–æ–¥–∏–Ω—É –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
3. ‚è≥ –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ª–æ–≥–∏ –ø—ñ—Å–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
4. ‚è≥ –í–∏–ø—Ä–∞–≤–∏—Ç–∏ –≤–∏—è–≤–ª–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏ (—è–∫—â–æ —î)

## –í–∞–∂–ª–∏–≤—ñ –ø—Ä–∏–º—ñ—Ç–∫–∏

- –í—Å—ñ –∑–º—ñ–Ω–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ —Ç–∞ –≥–æ—Ç–æ–≤—ñ –¥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
- –ö–æ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–∏–π –Ω–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–Ω—ñ –ø–æ–º–∏–ª–∫–∏
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –¥–æ–¥–∞–Ω–æ –∑ –ø—Ä–µ—Ñ—ñ–∫—Å–∞–º–∏ –¥–ª—è –ª–µ–≥–∫–æ–≥–æ –ø–æ—à—É–∫—É:
  - `[RECONCILE]` - reconciliation –æ–ø–µ—Ä–∞—Ü—ñ—ó
  - `[UPDATE]` - –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–∑–∏—Ü—ñ–π
  - `[POSITION]` - —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø–æ–∑–∏—Ü—ñ—ó
  - `[DISPLAY]` - –æ–ø–µ—Ä–∞—Ü—ñ—ó –≤–∏–≤–µ–¥–µ–Ω–Ω—è
  - `[SL]` - –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑—ñ —Å—Ç–æ–ø-–ª–æ—Å–∞–º–∏
